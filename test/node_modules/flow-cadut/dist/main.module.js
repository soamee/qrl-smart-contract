import{config as n}from"@onflow/config";import*as t from"@onflow/types";import*as r from"@onflow/fcl";import{config as e}from"@onflow/fcl";import{ec as o}from"elliptic";import{SHA3 as c}from"sha3";const i={emulator:{FungibleToken:"0xee82856bf20e2aa6",FlowFees:"0xe5a8b7f23e8b548f",FlowStorageFees:"0xf8d6e0586b0a20c7",FlowToken:"0x0ae53cb6e3f42a79"},testnet:{FungibleToken:"0x9a0766d93b6608b7",NonFungibleToken:"0x631e88ae7f1d7c20",FlowClusterQC:"0x9eca2b38b18b5dfe",FlowDKG:"0x9eca2b38b18b5dfe",FlowEpoch:"0x9eca2b38b18b5dfe",FlowIDTableStaking:"0x9eca2b38b18b5dfe",FlowToken:"0x7e60df042a9c0868",LockedTokens:"0x95e019a17d0e23d7",StakingProxy:"0x7aad92e5a0715d21",FlowStakingCollection:"0x95e019a17d0e23d7",FUSD:"0xe223d8a629e49c68"},mainnet:{FungibleToken:"0xf233dcee88fe0abe",NonFungibleToken:"0x1d7e57aa55817448",FlowClusterQC:"0x8624b52f9ddcd04a",FlowDKG:"0x8624b52f9ddcd04a",FlowEpoch:"0x8624b52f9ddcd04a",FlowIDTableStaking:"0x8624b52f9ddcd04a",FlowFees:"0xf919ee77447b7497",FlowToken:"0x1654653399040a61",LockedTokens:"0x8d0e87b65159ae63",StakingProxy:"0x62430cf28c26d095",FlowStakingCollection:"0x8d0e87b65159ae63",FUSD:"0x3c5959b568896393"}},s={emulator:{},testnet:{},mainnet:{}},u=n=>{for(const t of Object.keys(s)){const r=n[t],{name:e}=n;s[t]={...s[t],..."object"==typeof n[t]?r:{[e]:r}}}},a={mainnet:"https://access-mainnet-beta.onflow.org",testnet:"https://access-testnet.onflow.org",emulator:"http://localhost:8080"},f=function(){try{return Promise.resolve(function(){try{return Promise.resolve(n().get("ix.env")).then(function(n){return n||"emulator"})}catch(n){return Promise.reject(n)}}()).then(function(n){return{...i[n]||i.emulator,...s[n]||s.emulator}})}catch(n){return Promise.reject(n)}},l=function(t="emulator",r={}){try{const e=t.toLowerCase();if(!i[e])throw new Error(`Provided value "${e}" is not supported. Try "emulator", "testnet" or "mainnet". Default: "emulator"`);const{port:o,endpoint:c,limit:s,extend:f}=r,l="emulator"===e&&o?`http://localhost:${o}`:a[e],d=c||l;return Promise.resolve(n().put("ix.env",e)).then(function(){function t(){return f&&u(f),Promise.resolve(n().put("accessNode.api",d)).then(function(){})}const r=function(){if(s)return Promise.resolve(n().put("ix.executionLimit",s)).then(function(){})}();return r&&r.then?r.then(t):t()})}catch(n){return Promise.reject(n)}},d=n=>n.split(/\s/).map(n=>n.replace(/\s/g,"")).filter(n=>n.length>0&&"import"!==n&&"from"!==n),m=(n,t)=>{const[r,e]=t;return n[r]=e,n},p=n=>n&&0!==n.length?n.split("\n").filter(n=>n.includes("import")).map(d).reduce(m,{}):{},h=(n,t={})=>{const r=p(n),e=[];for(const n in r)!t[n]&&Object.prototype.hasOwnProperty.call(r,n)&&e.push(n);return e},g=(n=[],t="")=>{const r="Missing imports for contracts:";console.error(t?`${t} ${r}`:r,n)},w=(n,t,r="")=>{const e=h(n,t);e.length>0&&g(e,r)},x=/(\s*import\s*)([\w\d]+)(\s+from\s*)([\w\d".\\/]+)/g,y=(n,t,r=!0)=>n.replace(x,(n,e,o,c,i)=>{const s=r?o:i;return`${e}${o} from ${(t instanceof Function?t(s):t[s])||i}`}),P=["public","private","storage"],b=n=>{const[t]=n.split("");return t.toUpperCase()+n.slice(1)},v=n=>n.replace(/-/g,"_").split("_").map((n,t)=>t>0?b(n):n).join(""),F=(n,t,r)=>r?n.replace(t,"").split(r):n.replace(t,"").split(k(n)),k=n=>{switch(!0){case n.indexOf("//")>=0:return"//";case n.indexOf("/")>=0:return"/";case n.indexOf("\\")>=0:return"\\";default:return""}},S=n=>n.replace(/\s+/g," "),$="contract",E="transaction",I="script",T=n=>n.split(",").map(n=>n.replace(/\s*/g,"")).filter(n=>""!==n),N=n=>n.replace(/(\/\*[\s\S]*?\*\/)|(\/\/.*)/g,""),A=(n,t)=>{const r=N(n),e=S(r.replace(/[\n\r]/g,""));if(e){const n=new RegExp(t,"g").exec(e);if(n)return""===n[1]?[]:T(n[1])}return[]},C=n=>A(n,"(?:prepare\\s*\\(\\s*)([^\\)]*)(?:\\))"),B=n=>A(n,"(?:fun\\s+main\\s*\\(\\s*)([^\\)]*)(?:\\))"),D=n=>A(n,"(?:transaction\\s*\\(\\s*)([^\\)]*)(?:\\))"),j=n=>U(n).contractName,U=n=>{const t=N(n).replace(/(resource|struct)\s+\w+\s*{[\s\S]+?}/g,""),r=/(?:access\(\w+\)|pub)\s+contract\s+(?:interface)*\s*(\w*)(\s*{[.\s\S]*init\s*\((.*?)\)[.\s\S]*})?/g.exec(t);if(!r||r.length<2)throw new Error("Contract Error: can't find name of the contract");return{contractName:r[1],args:r[3]||""}},q=n=>{const t=N(n);if(/transaction\s*(\(\s*\))*\s*/g.test(t)){const n=C(t),r=D(t);return{type:"transaction",signers:n.length,args:r}}if(/pub\s+fun\s+main\s*/g.test(t))return{type:"script",args:B(t)};if(/\w+\s+contract\s+(\w*\s*)\w*/g.test(t)){const{contractName:n,args:r}=U(t);return{type:"contract",signers:1,args:r,contractName:n}}return{type:"unknown"}},K=n=>!n||"string"!=typeof n,L=n=>!K(n)&&(n.startsWith("Int")||n.startsWith("UInt")||n.startsWith("Word")),M=n=>{if(K(n))return!1;const t=n.replace(/\s/g,"");return t.startsWith("[")&&t.endsWith("]")},_=n=>{if(K(n))return!1;const t=n.replace(/\s/g,"");return t.startsWith("{")&&t.endsWith("}")},G=n=>M(n)||_(n);function O(n,t,r){if(!n.s){if(r instanceof R){if(!r.s)return void(r.o=O.bind(null,n,t));1&t&&(t=r.s),r=r.v}if(r&&r.then)return void r.then(O.bind(null,n,t),O.bind(null,n,2));n.s=t,n.v=r;const e=n.o;e&&e(n)}}const R=function(){function n(){}return n.prototype.then=function(t,r){const e=new n,o=this.s;if(o){const n=1&o?t:r;if(n){try{O(e,1,n(this.v))}catch(n){O(e,2,n)}return e}return this}return this.o=function(n){try{const o=n.v;1&n.s?O(e,1,t?t(o):o):r?O(e,1,r(o)):O(e,2,o)}catch(n){O(e,2,n)}},e},n}(),H={ARGUMENT:"argument"},Q=function(n){try{const{type:t}=n;return Promise.resolve(e().get("ix.plugins")).then(function(r){const o=r||{},c=o[t]||[];return Promise.resolve(e().put("ix.plugins",{...o,[t]:[...c,n]})).then(function(){})})}catch(n){return Promise.reject(n)}},z=function(n){try{return Promise.resolve(e().get("ix.plugins")).then(function(t){const r=(t||{})[n];return!!(r&&r.length>0)&&r})}catch(n){return Promise.reject(n)}};function W(n,t,r){if(!n.s){if(r instanceof J){if(!r.s)return void(r.o=W.bind(null,n,t));1&t&&(t=r.s),r=r.v}if(r&&r.then)return void r.then(W.bind(null,n,t),W.bind(null,n,2));n.s=t,n.v=r;const e=n.o;e&&e(n)}}const J=function(){function n(){}return n.prototype.then=function(t,r){const e=new n,o=this.s;if(o){const n=1&o?t:r;if(n){try{W(e,1,n(this.v))}catch(n){W(e,2,n)}return e}return this}return this.o=function(n){try{const o=n.v;1&n.s?W(e,1,t?t(o):o):r?W(e,1,r(o)):W(e,2,o)}catch(n){W(e,2,n)}},e},n}(),V=n=>n.split(/(\w+)\s*:\s*([\w{}[\]:\s?]*)/).filter(n=>""!==n).map(n=>n.replace(/\s*/g,"")),X=n=>V(n)[1],Y=n=>/{(.*)}/.exec(n)[1].split(/([^:]*):(.*)/).map(n=>n.replace(/\s/g,"")).filter(n=>n),Z=n=>/\[(.*)\]/.exec(n)[1].replace(/\s+/g,""),nn=(n,t,r="")=>{if(t>n){const e=`Incorrect number of arguments: found ${n} of ${t}`;console.error(r?`${r} ${e}`:e)}},tn=(n="items",t,r,e="")=>{if(r!==t){const o=`Incorrect number of ${n}: found ${t} of ${r}`;console.error(e?`${e} ${o}`:o)}},rn=n=>!K(n)&&(n.includes("?")?t.Optional(t[(n=>n.slice(0,-1))(n)]):t[n]),en=n=>{if(G(n))switch(!0){case M(n):{const r=Z(n);return t.Array(en(r))}case _(n):{const[r,e]=Y(n),o={key:en(r),value:en(e)};return t.Dictionary(o)}default:return rn(n)}return rn(n)},on=function(n,t){try{return Promise.resolve(z(H.ARGUMENT)).then(function(e){function o(){let n;const t=en(i);switch(!0){case(n=>{if(K(n))return!1;let t=n.endsWith("?")?n.slice(0,-1):n;return L(t)||(n=>"String"===n)(t)||(n=>"Character"===n)(t)||(n=>"Bool"===n)(t)})(i):return r.arg(c,t);case(n=>!K(n)&&(n.startsWith("Fix64")||n.startsWith("UFix64")))(i):return null===c?r.arg(null,t):(isNaN(parseFloat(c))&&(n=>{throw new Error("Type Error: Expected proper value for fixed type")})(),r.arg(parseFloat(c).toFixed(8),t));case(n=>"Address"===n||"Address?"===n)(i):{const n=null==(d=c)?null:"0x"+(n=>null==n?null:n.replace(/^0x/,""))(d);return r.arg(n,t)}case(n=>"Path"===n||"Path?"===n)(i):return r.arg((n=>{if(n.startsWith("/")){const t=n.slice(1).split("/");if(2!==t.length)throw Error("Incorrect Path - identifier missing");if(!P.includes(t[0]))throw Error("Incorrect Path - wrong domain");const[r,e]=t;return{domain:r,identifier:e}}throw Error("Incorrect Path - shall start with `/`")})(c),t);case M(i):{function e(e){return n?e:r.arg(c,t)}const o=Z(i),s=function(){if(G(o))return Promise.resolve(Promise.all(c.map(function(n){try{return Promise.resolve(on(o,n)).then(function({value:n}){return n})}catch(n){return Promise.reject(n)}}))).then(function(e){return n=1,r.arg(e,t)})}();return s&&s.then?s.then(e):e(s)}case _(i):{function o(){return r.arg(d,t)}const[n,e]=Y(i),d=[],m=Object.keys(c),p=(s=m,u=function(t){function r(){const t=L(n)?parseInt(o):o;d.push({key:t,value:i})}const o=m[t];let i;const s=function(){if(G(e))return Promise.resolve(on(e,c[o])).then(function(n){i=n.value});i=c[o]}();return s&&s.then?s.then(r):r()},l=-1,function n(t){try{for(;++l<s.length;)if((t=u(l))&&t.then){if(!((r=t)instanceof J&&1&r.s))return void t.then(n,f||(f=W.bind(null,a=new J,2)));t=t.v}a?W(a,1,t):a=t}catch(n){W(a||(a=new J),2,n)}var r}(),a);return p&&p.then?p.then(o):o()}default:throw`${i} is not supported`}var s,u,a,f,l,d}let c=t,i=n;const s=function(){if(e)return Promise.resolve(function(n,t){try{function r(){return{type:u,value:a}}let u=n.type,a=n.value;const f=(e=t,o=function(n){const{resolver:r}=t[n];return Promise.resolve(r(u,a)).then(function(n){u=n.type,a=n.value})},s=-1,function n(t){try{for(;++s<e.length;)if((t=o(s))&&t.then){if(!((r=t)instanceof R&&1&r.s))return void t.then(n,i||(i=O.bind(null,c=new R,2)));t=t.v}c?O(c,1,t):c=t}catch(n){O(c||(c=new R),2,n)}var r}(),c);return Promise.resolve(f&&f.then?f.then(r):r())}catch(n){return Promise.reject(n)}var e,o,c,i,s}({type:n,value:t},e)).then(function(n){c=n.value,i=n.type})}();return s&&s.then?s.then(o):o()})}catch(n){return Promise.reject(n)}},cn=function(n=[],t){try{if(n.length>t.length)throw new Error("Not enough arguments");return Promise.all(t.map(function(t,r){try{return Promise.resolve(on(n[r],t)).then(function(n){var t;return(t=n).xform.asArgument(t.value),n})}catch(n){return Promise.reject(n)}}))}catch(n){return Promise.reject(n)}},sn=function(n,t=[]){try{const r=q(n).args.map(X);return cn(r,t)}catch(n){return Promise.reject(n)}},un=function(n,t){try{if(0===n.length)return Promise.resolve([]);const e=n[0];return Array.isArray(e)&&e.length>0&&e[e.length-1].asArgument?Promise.resolve((n=>n.reduce((n,t)=>[...n,...((n,t)=>{const e=n[n.length-1];return n.slice(0,-1).map(n=>((n,t)=>r.arg(n,t))(n,e))})(t)],[]))(n)):sn(t,n)}catch(n){return Promise.reject(n)}},an=n=>null==n?null:n.replace(/^0x/,""),fn=new o("p256"),ln=(n,t)=>{const r=fn.keyFromPrivate(Buffer.from(n,"hex")).sign((n=>{const t=new c(256);return t.update(Buffer.from(n,"hex")),t.digest()})(t)),e=r.r.toArrayLike(Buffer,"be",32),o=r.s.toArrayLike(Buffer,"be",32);return Buffer.concat([e,o]).toString("hex")},dn=n=>{if("string"==typeof n)return n;if("object"==typeof n){if(void 0===n.privateKey)throw Error("privateKey is required");if(void 0===n.address)throw Error("address is required");void 0===n.keyId&&console.warning(`key index have incorrect format. found '${typeof n.keyId}', required 'num'`);const{address:t,privateKey:e,keyId:o=0}=n;return((n,t,e=0)=>function(o={}){try{n=an(n);const c=function(r){try{return Promise.resolve({keyId:e,addr:(o=n,null==o?null:"0x"+an(o)),signature:ln(t,r.message)})}catch(n){return Promise.reject(n)}var o};return Promise.resolve({...o,tempId:`${n}-${e}`,addr:r.sansPrefix(n),keyId:e,signingFunction:c})}catch(n){return Promise.reject(n)}})(t,e,o)}throw Error("Incorrect format for signer")};function mn(n,t){try{var r=n()}catch(n){return t(n)}return r&&r.then?r.then(void 0,t):r}const pn=function(t,e){try{const{code:o,cadence:c,args:i,addressMap:s,limit:u,processed:a}=t,l=o||c;return Promise.resolve(f()).then(function(o){function c(){return Promise.resolve(n().get("ix.executionLimit")).then(function(n){if(m.push(r.limit(u||n||100)),"transaction"===e){const{proposer:n,payer:e,signers:o=[]}=t,c=0===o.length?[e]:o,i=n||e;m.push(r.payer(dn(e))),m.push(r.proposer(dn(i))),m.push(r.authorizations(c.map(dn)))}return r.send(m)})}const f={...o,...s},d=a?l:y(l,f),m="script"===e?[r.script(d)]:[r.transaction(d)],p=function(){if(i)return Promise.resolve(un(i,l)).then(function(n){m.push(r.args(n))})}();return p&&p.then?p.then(c):c()})}catch(n){return Promise.reject(n)}},hn=function(n){const{raw:t=!1}=n;return Promise.resolve(mn(function(){return Promise.resolve(pn(n,"script")).then(function(n){return t?[n.encodedData,null]:Promise.resolve(r.decode(n)).then(function(n){return[n,null]})})},function(n){return[null,n]}))},gn=function(n){const{wait:t="seal"}=n;return Promise.resolve(mn(function(){return Promise.resolve(pn(n,"transaction")).then(function(n){let e;function o(t){return e?t:[n.transactionId,null]}const c=function(){if(t){const o=(n=>{if("string"==typeof n){const t=n.toLowerCase();if(t.includes("final"))return"onceFinalized";if(t.includes("exec"))return"onceExecuted";if(t.includes("seal"))return"onceSealed"}return console.log(`⚠️ [33mStatus value [1m[35m"${n}"[33m[2m is not supported. Reverting to [32m"onceSealed"[0m`),"onceSealed"})(t);return Promise.resolve(r.tx(n)[o]()).then(function(t){const r={txId:n,...t};return e=1,[r,null]})}}();return c&&c.then?c.then(o):o(c)})},function(n){return[null,n]}))},wn=function(n){try{const{name:t,to:r,payer:e,proposer:o,code:c,update:i=!1,processed:s=!1,addressMap:u={}}=n,a=s?c:y(c,u),f=i?"\n    transaction(name: String, code: String) {\n      prepare(acct: AuthAccount){\n        let decoded = code.decodeHex()\n        \n        acct.contracts.add(\n          name: name,\n          code: decoded,\n        )\n      }\n    }\n  ":"\n  transaction(name: String, code: String){\n    prepare(acct: AuthAccount){\n      let decoded = code.decodeHex()\n      \n      if acct.contracts.get(name: name) == nil {\n        acct.contracts.add(name: name, code: decoded)\n      } else {\n        acct.contracts.update__experimental(name: name, code: decoded)\n      }\n    }\n  }\n",l=Buffer.from(a,"utf8").toString("hex");let d=r,m=r;return e&&(m=e,d=o||e),gn({payer:m,proposer:d,signers:[r],code:f,args:[t,l]})}catch(n){return Promise.reject(n)}},xn=function(n){try{return wn({...n,update:!0})}catch(n){return Promise.reject(n)}};export{$ as CONTRACT,H as PLUGIN_TYPES,I as SCRIPT,E as TRANSACTION,X as argType,b as capitalizeFirstLetter,S as collapseSpaces,wn as deployContract,hn as executeScript,u as extendEnvironment,A as extract,j as extractContractName,U as extractContractParameters,p as extractImports,B as extractScriptArguments,C as extractSigners,D as extractTransactionArguments,T as generateSchema,Z as getArrayType,Y as getDictionaryTypes,f as getEnvironment,z as getPlugins,k as getSplitCharacter,q as getTemplateInfo,on as mapArgument,cn as mapArguments,sn as mapValuesToCode,h as missingImports,gn as mutate,hn as query,Q as registerPlugin,y as replaceImportAddresses,g as report,nn as reportArguments,tn as reportMissing,w as reportMissingImports,un as resolveArguments,gn as sendTransaction,l as setEnvironment,V as splitArgs,F as trimAndSplit,v as underscoreToCamelCase,xn as updateContract};
//# sourceMappingURL=main.module.js.map
